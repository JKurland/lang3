changed add_flow to evaluate_and_store, fix all the evaluate and store calls